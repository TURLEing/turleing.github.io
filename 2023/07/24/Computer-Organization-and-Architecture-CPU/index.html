<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <meta charset="UTF-8">
  <meta 
    name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <meta 
    http-equiv="X-UA-Compatible" 
    content="ie=edge">
  <meta 
    name="theme-color" 
    content="#fff" 
    id="theme-color">
  <meta 
    name="description" 
    content="天泽龟的龟壳屋">
  <link 
    rel="icon" 
    href="https://i.loli.net/2021/07/16/yKghkEQWcY34rOU.jpg">
  <title>计算机组成原理：CPU 与流水线技术</title>
  
    
      <meta 
        property="og:title" 
        content="计算机组成原理：CPU 与流水线技术">
    
    
      <meta 
        property="og:url" 
        content="https://turleing.github.io/2023/07/24/Computer-Organization-and-Architecture-CPU/index.html">
    
    
      <meta 
        property="og:img" 
        content="https://i.loli.net/2021/07/16/yKghkEQWcY34rOU.jpg">
    
    
      <meta 
        property="og:img" 
        content="&lt;p&gt;&lt;code&gt;Surface Pen&lt;/code&gt; 又被我丢了，感觉不如直接用 Typora 整理笔记。&lt;/p&gt;">
    
    
      <meta 
        property="og:type" 
        content="article">
      <meta 
        property="og:article:published_time" 
        content="2023-07-24">
      <meta 
        property="og:article:modified_time" 
        content="2023-07-27">
      <meta 
        property="og:article:author" 
        content="天泽龟">
      
        
          <meta 
            property="og:article:tag" 
            content="计算机组成原理">
        
      
    
  
  <script>
    function loadScript(url, cb) {
      var script = document.createElement('script');
      script.src = url;
      if (cb) script.onload = cb;
      script.async = true;
      document.body.appendChild(script);
    }
    function loadCSS(href, data, attr) {
      var sheet = document.createElement('link');
      sheet.ref = 'stylesheet';
      sheet.href = href;
      sheet.dataset[data] = attr;
      document.head.appendChild(sheet);
    }
    function changeCSS(cssFile, data, attr) {
      var oldlink = document.querySelector(data);
      var newlink = document.createElement("link");
      newlink.setAttribute("rel", "stylesheet");
      newlink.setAttribute("href", cssFile);
      newlink.dataset.prism = attr;
      document.head.replaceChild(newlink, oldlink);
    }
  </script>
  
    
  
  <script>
    // control reverse button
    var reverseDarkList = {
      dark: 'light',
      light: 'dark'
    };
    var themeColor = {
      dark: '#1c1c1e',
      light: '#fff'
    }
    // get the data of css prefers-color-scheme
    var getCssMediaQuery = function() {
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    };
    // reverse current darkmode setting function
    var reverseDarkModeSetting = function() {
      var setting = localStorage.getItem('user-color-scheme');
      if(reverseDarkList[setting]) {
        setting = reverseDarkList[setting];
      } else if(setting === null) {
        setting = reverseDarkList[getCssMediaQuery()];
      } else {
        return;
      }
      localStorage.setItem('user-color-scheme', setting);
      return setting;
    };
    // apply current darkmode setting
  </script>
  
    <script>
      var setDarkmode = function(mode) {
      var setting = mode || localStorage.getItem('user-color-scheme');
      if(setting === getCssMediaQuery()) {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[setting];
        document.getElementById('theme-color').dataset.mode = setting;
      } else if(reverseDarkList[setting]) {
        document.documentElement.setAttribute('data-user-color-scheme', setting);
        document.getElementById('theme-color').content = themeColor[setting];
        document.getElementById('theme-color').dataset.mode = setting;
      } else {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[getCssMediaQuery()];
        document.getElementById('theme-color').dataset.mode = getCssMediaQuery();
      }
    };
    setDarkmode();
    </script>
  
  
  <link rel="preload" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css" as="style" >
  <link rel="preload" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css" as="style" >
  
  
    <link rel="preload" href="/js/lib/lightbox/baguetteBox.min.js" as="script">
    <link rel="preload" href="/js/lib/lightbox/baguetteBox.min.css" as="style" >
  
  
    <link rel="preload" href="/js/lib/lozad.min.js" as="script">
  
  
  
  
    
    <link rel="prefetch" href="//cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" as="script">
  
  
    
    <link rel="prefetch" href="//unpkg.com/valine/dist/Valine.min.js" as="script">
  
  
  
  <link rel="stylesheet" href="/css/main.css">
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css">
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css">
  
    <link rel="stylesheet" href="/js/lib/lightbox/baguetteBox.min.css">
  
<meta name="generator" content="Hexo 5.4.0"></head>

  <body>
    <div class="wrapper">
       
      <nav class="navbar">
  <div class="navbar-logo">
    <span class="navbar-logo-main">
      
        <img 
          class="navbar-logo-img" 
          src="https://i.loli.net/2021/07/16/yKghkEQWcY34rOU.jpg" 
          alt="blog logo">
      
      <span class="navbar-logo-dsc">天泽龟的龟壳屋</span>
    </span>
  </div>
  <div class="navbar-menu">
    
      <a 
        href="/" 
        class="navbar-menu-item">
        
          首页
        
      </a>
    
      <a 
        href="/archives" 
        class="navbar-menu-item">
        
          归档
        
      </a>
    
      <a 
        href="/tags" 
        class="navbar-menu-item">
        
          标签
        
      </a>
    
      <a 
        href="/categories" 
        class="navbar-menu-item">
        
          分类
        
      </a>
    
      <a 
        href="/about" 
        class="navbar-menu-item">
        
          关于
        
      </a>
    
      <a 
        href="/links" 
        class="navbar-menu-item">
        
          友链
        
      </a>
    
      <a 
        href="/bangumis" 
        class="navbar-menu-item">
        
          番剧
        
      </a>
    
    <a 
      class="navbar-menu-item darknavbar" 
      id="dark">
      <i class="iconfont icon-weather"></i>
    </a>
    <a 
      class="navbar-menu-item searchnavbar" 
      id="search">
      <i 
        class="iconfont icon-search" 
        style="font-size: 1.2rem; font-weight: 400;">
      </i>
    </a>
  </div>
</nav> 
      
      <div 
        id="local-search" 
        style="display: none">
        <input
          class="navbar-menu-item"
          id="search-input"
          placeholder="请输入搜索内容..." />
        <div id="search-content"></div>
      </div>
      
      <div class="section-wrap">
        <div class="container">
          <div class="columns">
            <main class="main-column">
<article class="card card-content">
  <header>
    <h1 class="post-title">
      计算机组成原理：CPU 与流水线技术
    </h1>
  </header>
  <div class="post-meta post-show-meta">
    <time datetime="2023-07-24T05:07:06.000Z">
      <i 
        class="iconfont icon-calendar" 
        style="margin-right: 2px;">
      </i>
      <span>2023-07-24</span>
    </time>
    
      <span class="dot"></span>
      
        <a 
          href="/categories/%E4%B8%93%E4%B8%9A%E5%AD%A6%E4%B9%A0/" 
          class="post-meta-link">
          专业学习
        </a>
      
    
    
      <span class="dot"></span>
      <span>2.5k 字</span>
    
  </div>
  
    <div 
      class="post-meta post-show-meta" 
      style="margin-top: -10px;">
      <div style="display: flex; align-items: center;">
        <i 
          class="iconfont icon-biaoqian" 
          style="margin-right: 2px; font-size: 1.15rem;">
        </i>
        
          
          <a 
            href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" 
            class="post-meta-link">
            计算机组成原理
          </a>
        
      </div>
    </div>
  
  </header>
  <div 
    id="section" 
    class="post-content">
    <p><code>Surface Pen</code> 又被我丢了，感觉不如直接用 Typora 整理笔记。</p>
<span id="more"></span>
<h2 id="知识回顾看之前笔记"><a class="markdownIt-Anchor" href="#知识回顾看之前笔记"></a> 知识回顾（看之前笔记）</h2>
<ul>
<li>微指令：每条机器指令对应一个微程序（多条微指令），并将微程序放在 ROM 中调用执行。</li>
<li>基本格式：包含控制信号（微操作）以及下一条微指令的地址。</li>
<li>编码：直接表示、编码表示、混合表示</li>
<li>微地址形成方法：计数器、多路转移；</li>
<li>微指令的指令格式：水平型、垂直型；</li>
</ul>
<p><img src="image-20230724131647578.png" alt="image-20230724131647578" / srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20230724131647578.png" class="lozad post-image"></p>
<br>
<h2 id="硬布线控制器抽象"><a class="markdownIt-Anchor" href="#硬布线控制器抽象"></a> 硬布线控制器（抽象）</h2>
<ul>
<li>从控制存储器中读出微操作很慢，所以不如直接用组合电路（硬件）去做</li>
<li>时序产生器除了产生节拍脉冲 M，还会产生节拍点位 T</li>
<li><img src="image-20230724132926563.png" alt="image-20230724132926563" / srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20230724132926563.png" class="lozad post-image"></li>
</ul>
<br>
<h2 id="硬布线控制器以-mips-为例"><a class="markdownIt-Anchor" href="#硬布线控制器以-mips-为例"></a> 硬布线控制器（以 MIPS 为例）</h2>
<h3 id="1-logic-elements"><a class="markdownIt-Anchor" href="#1-logic-elements"></a> 1. Logic Elements</h3>
<ul>
<li>Combinational element, e.g. ALU</li>
<li>State elements / State Machine, e.g. register</li>
</ul>
<p><img src="image-20230724133312755.png" alt="image-20230724133312755" / srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20230724133312755.png" class="lozad post-image"></p>
<br>
<h3 id="2-alu-control"><a class="markdownIt-Anchor" href="#2-alu-control"></a> 2. ALU control</h3>
<ul>
<li>Used for <code>ALUOp</code>: Load/Store, Add/Subtract, R-type(Based on <code>funct</code> field)</li>
<li>Select the ALU control based on A <strong>Truth Table</strong><br />
<br></li>
</ul>
<h3 id="3-main-control"><a class="markdownIt-Anchor" href="#3-main-control"></a> 3. Main control</h3>
<p>Generate according control signals(e.g. branch, ALUOp).</p>
<p><img src="image-20230724135000148.png" alt="image-20230724135000148" / srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20230724135000148.png" class="lozad post-image"><br />
<br></p>
<h3 id="4-jumps-control"><a class="markdownIt-Anchor" href="#4-jumps-control"></a> 4. Jumps control</h3>
<p>Update PC with concatenation of <strong>Top 4 bits</strong> of old PC and <strong>26-bit jump address with 2-left shift</strong>.</p>
<p><img src="image-20230724135204534.png" alt="image-20230724135204534" / srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20230724135204534.png" class="lozad post-image"><br />
<br></p>
<h3 id="5-性能问题"><a class="markdownIt-Anchor" href="#5-性能问题"></a> 5. 性能问题</h3>
<ul>
<li>最长延迟取决于时钟周期（关键路径：load 指令）</li>
<li>对于指令执行时间差异较大，则设计方案效率低，必须“加速大概率事件”。<br />
<br></li>
</ul>
<h2 id="流水线技术"><a class="markdownIt-Anchor" href="#流水线技术"></a> 流水线技术</h2>
<h3 id="1-背景"><a class="markdownIt-Anchor" href="#1-背景"></a> 1. 背景</h3>
<ul>
<li>早期冯诺依曼计算机基于串行处理，如何改进？</li>
<li>加快计算机的主频，但这是有上限的；</li>
<li>或者采用<strong>并行执行</strong>：在相同时延的条件下，用 n 位运算器进行 n 位并行运算（即每一位单独相加）</li>
<li>广义并行：在同一时刻（同时性）或者在同一时间间隔内（并发性）完成多个任务，都可体现其并行性<br />
<br></li>
</ul>
<h3 id="2-并行技术的三种形式"><a class="markdownIt-Anchor" href="#2-并行技术的三种形式"></a> 2. 并行技术的三种形式</h3>
<ul>
<li>时间并行：让多个处理过程在时间上相互 错开，轮流重叠地使用同一套硬件设备的各个部件。</li>
<li>空间并行：强调资源重复，以数量取胜（例如：多处理器系统）</li>
<li>时间+空间并行：Pentium 中采用<strong>超标量流水线技术</strong>，在时间并行的前提下，建立多条流水线实现资源重复。</li>
</ul>
<br>
<h3 id="25-流水线的分类"><a class="markdownIt-Anchor" href="#25-流水线的分类"></a> 2.5 流水线的分类</h3>
<ul>
<li>指令流水线：指令步骤的并行</li>
<li>算术流水线：运算操作步骤的并行，如流水线加法器、流水线乘法器等</li>
<li>处理机流水线：程序步骤的并行，也称为宏流水线；或采用多台级联的处理机构成流水线各阶段</li>
</ul>
<br>
<h3 id="3-流水线计算机的系统组成"><a class="markdownIt-Anchor" href="#3-流水线计算机的系统组成"></a> 3. 流水线计算机的系统组成</h3>
<ul>
<li>存储器体系：主存采用多体交叉存储器；Cache</li>
<li>流水线（pipelining）CPU：
<ul>
<li>指令部件：取指、译码、计算操作数地址、取操作数</li>
<li>指令队列：FIFO，存放译码后指令和取来的操作数</li>
</ul>
</li>
</ul>
<p><img src="image-20230724142706237.png" alt="image-20230724142706237" / srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20230724142706237.png" class="lozad post-image"></p>
<br>
<h3 id="4-流水线指令执行"><a class="markdownIt-Anchor" href="#4-流水线指令执行"></a> 4. 流水线指令执行</h3>
<p>把指令的处理过程分解为多个处理步骤，让多条指令能在各 处理步骤重叠执行，从而实现以流水线方式执行指令，达到 加快指令总体执行时间的目的。</p>
<p>具体可以分解为五步操作：取指、译码与读寄存器、执行、访问存储器、写回寄存器</p>
<p>二者对应的时间成本如下：</p>
<p><img src="image-20230724143046191.png" alt="image-20230724143046191" / srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20230724143046191.png" class="lozad post-image"></p>
<br>
<h3 id="5-流水技术原理"><a class="markdownIt-Anchor" href="#5-流水技术原理"></a> 5. 流水技术原理</h3>
<ul>
<li>本质上是把一个任务分解为几个有联系的子任务。每个子任务由一个专门的功能部件实现！</li>
<li>在流水线中的每个功能部件之后都要有一个<strong>缓冲寄存器</strong> ，每个阶段的输出结果需要被暂存</li>
<li>流水线中各段的时间必须有相等的时钟周期，防止 “堵塞” 或 “断流”</li>
<li>流水线需要有装入时间和排空时间，只有当流水线 完全充满时，才能充分发挥效率</li>
</ul>
<p>设阶段 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>S</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">S_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 所需的时间为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>τ</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">τ_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.1132em;">τ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，缓冲寄存器的延时为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>τ</mi><mi>l</mi></msub></mrow><annotation encoding="application/x-tex">τ_l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.1132em;">τ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> ，则线性流水线的时钟周期定义为：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>τ</mi><mo>=</mo><mi>max</mi><mo>⁡</mo><mrow><msub><mi>τ</mi><mi>i</mi></msub><mo>+</mo><msub><mi>τ</mi><mi>l</mi></msub></mrow><mo>=</mo><msub><mi>τ</mi><mi>m</mi></msub><mo>+</mo><msub><mi>τ</mi><mi>l</mi></msub></mrow><annotation encoding="application/x-tex">τ = \max{ τ_i + τ_l} = τ_m + τ_l
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.1132em;">τ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mop">max</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.1132em;">τ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.1132em;">τ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.1132em;">τ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.1132em;">τ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<br>
<h3 id="6-流水线性能指标"><a class="markdownIt-Anchor" href="#6-流水线性能指标"></a> 6. 流水线性能指标</h3>
<h4 id="61-流水时空图"><a class="markdownIt-Anchor" href="#61-流水时空图"></a> 6.1 流水时空图</h4>
<p>假设每个阶段所耗时间 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">△</mi><mi>τ</mi></mrow><annotation encoding="application/x-tex">\triangle τ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord">△</span><span class="mord mathdefault" style="margin-right:0.1132em;">τ</span></span></span></span>，并行执行 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> 条指令，每条指令有 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> 个阶段，则总时间 T ：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><mo>=</mo><mi>k</mi><mo>⋅</mo><mi mathvariant="normal">△</mi><mi>τ</mi><mtext> </mtext><mo>+</mo><mtext> </mtext><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>⋅</mo><mi mathvariant="normal">△</mi><mi>τ</mi></mrow><annotation encoding="application/x-tex">T = k \cdot \triangle τ ~+~ (n-1)\cdot \triangle τ
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">△</span><span class="mord mathdefault" style="margin-right:0.1132em;">τ</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mspace nobreak"> </span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mspace nobreak"> </span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord">△</span><span class="mord mathdefault" style="margin-right:0.1132em;">τ</span></span></span></span></span></p>
<p><img src="image-20230724150402070.png" alt="image-20230724150402070" / srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20230724150402070.png" class="lozad post-image"></p>
<br>
<h4 id="62-流水线加速比"><a class="markdownIt-Anchor" href="#62-流水线加速比"></a> 6.2 流水线加速比</h4>
<p>衡量在不使用流水线和使用流水线两种情况下完成 n 个任务所用的时间比： <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mo>=</mo><msub><mi>T</mi><mn>0</mn></msub><mi mathvariant="normal">/</mi><msub><mi>T</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">S=T_0/T_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>由 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mn>0</mn></msub><mo>=</mo><mi>n</mi><mo>⋅</mo><mi>k</mi><mo>⋅</mo><mi mathvariant="normal">△</mi><mi>τ</mi></mrow><annotation encoding="application/x-tex">T_0 = n\cdot k\cdot \triangle τ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.44445em;vertical-align:0em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord">△</span><span class="mord mathdefault" style="margin-right:0.1132em;">τ</span></span></span></span> , <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mi>k</mi></msub><mo>=</mo><mo stretchy="false">(</mo><mi>k</mi><mo>+</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>⋅</mo><mi mathvariant="normal">△</mi><mi>τ</mi></mrow><annotation encoding="application/x-tex">T_k = (k+n-1)\cdot \triangle τ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord">△</span><span class="mord mathdefault" style="margin-right:0.1132em;">τ</span></span></span></span> ，可推出 S 的一般表达形式：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mo>=</mo><mi>n</mi><mo>⋅</mo><mfrac><mi>k</mi><mrow><mi>k</mi><mo>+</mo><mi>n</mi><mo>−</mo><mn>1</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">S = n \cdot \frac{k}{k+n-1}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.44445em;vertical-align:0em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.14077em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>其中，当 n 远大于 k 的情况下，最大加速比可以接近 k .</p>
<br>
<h4 id="63-吞吐率-tp"><a class="markdownIt-Anchor" href="#63-吞吐率-tp"></a> 6.3 吞吐率 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><mi>P</mi></mrow><annotation encoding="application/x-tex">TP</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span></span></span></span></h4>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><mi>P</mi><mo>=</mo><mi>n</mi><mi mathvariant="normal">/</mi><msub><mi>T</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">TP=n/T_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">n</span><span class="mord">/</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> , 其中 n 为指令条数，Tk 为执行 n 条指令所用时间，考察指令的执行效率。</p>
<p>当<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>→</mo><mi mathvariant="normal">∞</mi></mrow><annotation encoding="application/x-tex">n\to\infin</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord">∞</span></span></span></span>，即不考虑流水线装载的假设下，流水线可达到最大吞吐率：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><msub><mi>P</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub><mo>=</mo><munder><mo><mi>lim</mi><mo>⁡</mo></mo><mrow><mi>n</mi><mo>→</mo><mi mathvariant="normal">∞</mi></mrow></munder><mfrac><mi>n</mi><mrow><mo stretchy="false">(</mo><mi>k</mi><mo>+</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>⋅</mo><mi>τ</mi></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mi>τ</mi></mfrac></mrow><annotation encoding="application/x-tex">TP_{max} = \lim_{n\to\infin} \frac{n}{(k+n-1)\cdot τ} = \frac{1}{τ}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.0435600000000003em;vertical-align:-0.936em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-2.1em;margin-left:0em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mrel mtight">→</span><span class="mord mtight">∞</span></span></span></span><span style="top:-2.7em;"><span class="pstrut" style="height:2.7em;"></span><span><span class="mop">lim</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.10756em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.1132em;">τ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.1132em;">τ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<br>
<h3 id="7-流水线的特点"><a class="markdownIt-Anchor" href="#7-流水线的特点"></a> 7. 流水线的特点</h3>
<ul>
<li>流水线操作并不能加快任何一条指令的执行过程， 只能通过重叠执行，加快连续一串指令的执行过程</li>
<li>潜在加速比= 流水线级数 = k</li>
<li>流水线的速率受限于最慢的流水段； 流水段的执行时间若不均衡，则加速比很难提高</li>
<li>可能在下一个时钟周期中，下一条指令无法进入流水线或不能执行的情况，称之为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathcolor="red"><mi mathvariant="normal">冒</mi><mi mathvariant="normal">险</mi></mstyle></mrow><annotation encoding="application/x-tex">\color{red}冒险</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0em;vertical-align:0em;"></span><span class="mord cjk_fallback" style="color:red;">冒</span><span class="mord cjk_fallback" style="color:red;">险</span></span></span></span>（hazard）或相关</li>
</ul>
<br>
<h3 id="8-流水线冒险"><a class="markdownIt-Anchor" href="#8-流水线冒险"></a> 8. 流水线冒险</h3>
<ul>
<li>
<p>结构冒险（structural hazard）/ 资源相关：指多条 指令进入流水线后 <strong>在同一时钟周期内争用同一个资源</strong> ，导致发生冲突；</p>
</li>
<li>
<p>数据冒险（data hazard）/ 数据相关：一条指令的执行 <strong>依赖于</strong> 更早的一条还在流水线指令的执行结果；</p>
</li>
<li>
<p>控制冒险（control hazard）/ 控制相关：由条件转 移指令（或称分支指令）引起；</p>
<p>即：因为提前取到的指令并不是所需要的，从而导致指令不能在预定的时钟周期内执行。<br />
<br></p>
</li>
</ul>
<h4 id="81-结构冒险"><a class="markdownIt-Anchor" href="#81-结构冒险"></a> 8.1 结构冒险</h4>
<p><img src="image-20230724153752559.png" alt="image-20230724153752559" / srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20230724153752559.png" class="lozad post-image"></p>
<p>如上图，当指令4从存储器中取指时，则会与指令1读取存储器发生冲突。</p>
<p>为了消除结构冒险，可以采取暂停一个时钟，或者增设一个存储器，将指令和数据放在不同的存储器中。后者是改进的冯诺依曼架构，被称作哈弗结构。</p>
<br>
<h4 id="82-数据冒险"><a class="markdownIt-Anchor" href="#82-数据冒险"></a> 8.2 数据冒险</h4>
<p><img src="image-20230724160353987.png" alt="image-20230724160353987" / srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20230724160353987.png" class="lozad post-image"></p>
<p>如上图，指令二需要从 <code>$s0</code> 寄存器中取值作为操作数，但是该寄存器必须等待指令一写入 <code>$s0</code> 后才能被访问。比较传统的方式还是向流水线中加入气泡，推迟执行。</p>
<p>或者可采用一种 <strong>前推/旁路</strong> 的方法，即我们不必等待 <code>$s0</code> 的值被写入寄存器后再读取，而是当指令一的执行阶段结束时，添加一条旁路，将其输出直接作为指令二的输入。</p>
<p><img src="/image-20230724161216749.png" alt="image-20230724161216749" / srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="/image-20230724161216749.png" class="lozad post-image"></p>
<p><img src="image-20230724161438053.png" alt="image-20230724161438053" / srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20230724161438053.png" class="lozad post-image"></p>
<br>
<h4 id="83-控制冒险"><a class="markdownIt-Anchor" href="#83-控制冒险"></a> 8.3 控制冒险</h4>
<p><img src="image-20230724163536469.png" alt="image-20230724163536469" / srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20230724163536469.png" class="lozad post-image"></p>
<p>因为 取下一条指令依赖于分支指令的结果，而流水线不能保证总是能取到正确的指令，这将导致流水线阻塞。</p>
<p>一个做法是 <strong>等待到分支指令结果出来后，才取下一条指令</strong> 。分支指令的结果至少要到 ALU 才能判断。</p>
<p>如图所示，在判断之后可以通过增加专门硬件，在指令译码（第二）阶段完成寄存器比 较和目标地址计算。但还是会产生一个时钟的气泡。</p>
<p>为了消除控制冒险（阻塞），可采用分支预测的技术。</p>
<p><img src="image-20230724164141183.png" alt="image-20230724164141183" / srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20230724164141183.png" class="lozad post-image"><br />
<br></p>
<ul>
<li>
<p>简单静态预测：分支总是发生 / 不发生；</p>
</li>
<li>
<p>复杂静态预测：编译器在编译时分析程序完成 <strong>对指令序列的重排</strong>。</p>
<p>从分支指令进入流水线到得到结果这个时段（称之为 <strong>分支延迟时间槽</strong> branch delay slot），其后续若干指令也进入流水线，如果分支发生，则那些后续已进入流水线并译码的指令需要废弃。</p>
<p>因此，我们可以在延迟槽中安排分支指令之前的指令或分支指令目标处的指令，<strong>这些指令无论分支是发生都需要执行</strong> ，从而规避控制冒险。</p>
<p>当然，这种重排指令序列的处理由编译程序完成，且指令执行顺序的变动不能影响到程序的正确性。</p>
</li>
</ul>
<p><img src="image-20230724171231670.png" alt="image-20230724171231670" / srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20230724171231670.png" class="lozad post-image"></p>
<ul>
<li>
<p>动态分支预测：分支历史表 BHT</p>
<p>该表使用分支指令地址的低位部分进行 <strong>索引</strong> ，每一表项的预测位记录了 <strong>最近一次</strong> 是否发生过分支，以及记录了目标地址等内容。</p>
<p>通过查表，我们猜测当前指令会重复上一次分支的结果，并按照预测位执行。如果预测错误，则将预测位取反。</p>
</li>
</ul>
<p><img src="image-20230724171248019.png" alt="image-20230724171248019" / srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20230724171248019.png" class="lozad post-image"></p>
<br>
<h2 id="举例mips-流水线"><a class="markdownIt-Anchor" href="#举例mips-流水线"></a> 举例：MIPS 流水线</h2>
<p>回顾，一条指令可以分成五个阶段。</p>
<p><img src="image-20230724172105521.png" alt="image-20230724172105521" / srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20230724172105521.png" class="lozad post-image"></p>
<p>为了更改为流水线操作，在每个阶段之间需要添加 <strong>锁存器</strong> 存储上一阶段发来的有效信号，根据时钟周期执行。</p>
<p><img src="image-20230724172248059.png" alt="image-20230724172248059" / srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20230724172248059.png" class="lozad post-image"></p>
<p>由于指令被分成了若干阶段，对应的控制信号也被分成了若干组，在对应的阶段被使用。</p>
<p><img src="image-20230724173201774.png" alt="image-20230724173201774" / srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20230724173201774.png" class="lozad post-image"></p>
<h2 id="risc-处理器特点"><a class="markdownIt-Anchor" href="#risc-处理器特点"></a> RISC 处理器特点</h2>
<ul>
<li>有限而简单的指令集</li>
<li>CPU 具有大量的通用寄存器（32 个， CISC 一般就 16 个）</li>
<li>强调对于流水线的优化</li>
</ul>

  </div>
  <div>
    
      <div 
        class="post-note note-warning copyright" 
        style="margin-top: 42px">
        <p>
          <span style="font-weight: bold;">作者：</span><a 
            target="_blank" 
            rel="nofollow noopener noreferrer" 
            href="/about">
            天泽龟
          </a>
        </p>
        <p>
          <span style="font-weight: bold;">文章链接：</span><a 
            target="_blank" 
            rel="nofollow noopener noreferrer" 
            href="https://turleing.github.io/2023/07/24/Computer-Organization-and-Architecture-CPU/">
            https://turleing.github.io/2023/07/24/Computer-Organization-and-Architecture-CPU/
          </a>
        </p>
        <p><span style="font-weight: bold;">版权声明：</span>本博客所有文章除特别声明外，均采用<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0 协议</a>。转载请注明出处！</p>
      </div>
    
  </div>
</article>
<div class="nav">
  
    <div class="nav-item-prev">
      <a 
        href="/2023/07/26/Computer-Organization-and-Architecture-IO/" 
        class="nav-link">
        <i class="iconfont icon-left nav-prev-icon"></i>
        <div>
          <div class="nav-label">上一篇</div>
          
            <div class="nav-title">计算机组成原理：IO 系统 </div>
          
        </div>
      </a>
    </div>
  
  
    <div class="nav-item-next">
      <a 
        href="/2023/07/21/Personalized_Transformer/" 
        class="nav-link">
        <div>
          <div class="nav-label">下一篇</div>
          
            <div class="nav-title">记人生第一次论文复现以及微小的改进 </div>
          
        </div>
        <i class="iconfont icon-right nav-next-icon"></i>
      </a>
    </div>
  
</div>

  <div 
    class="card card-content comment-card" 
    style="margin-top: 16px;">
    <div class="comment-card-title">评论</div>
    
  <div id="vcomments"></div>
  
  <script>
    loadScript("//unpkg.com/valine/dist/Valine.min.js");
    var oldLoadVa = window.onload;
    window.onload = function () {
      oldLoadVa && oldLoadVa();
      new Valine({
        el: '#vcomments',
        appId: '4CiiPBXpbjDnPvIIwfuEPEY6-gzGzoHsz',
        appKey: '3AQY35K3Laq9fLvTG2uOHDUT',
        placeholder: '留下你的评论...',
        path: window.location.pathname,
        avatar: 'identicon',
        meta: ["nick","mail","link"],
        pageSize: '10',
        lang: '',
        visitor: 'false',
        highlight: true,
        recordIP: false,
        
        
        
        enableQQ: 'true',
        requiredFields: [],
      });
    };
  </script>

  </div>

<div 
  class="card card-content toc-card" 
  id="mobiletoc">
  <div class="toc-header">
  <i 
    class="iconfont icon-menu" 
    style="padding-right: 2px;">
  </i>目录
</div>
<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E5%9B%9E%E9%A1%BE%E7%9C%8B%E4%B9%8B%E5%89%8D%E7%AC%94%E8%AE%B0"><span class="toc-text"> 知识回顾（看之前笔记）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AC%E5%B8%83%E7%BA%BF%E6%8E%A7%E5%88%B6%E5%99%A8%E6%8A%BD%E8%B1%A1"><span class="toc-text"> 硬布线控制器（抽象）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AC%E5%B8%83%E7%BA%BF%E6%8E%A7%E5%88%B6%E5%99%A8%E4%BB%A5-mips-%E4%B8%BA%E4%BE%8B"><span class="toc-text"> 硬布线控制器（以 MIPS 为例）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-logic-elements"><span class="toc-text"> 1. Logic Elements</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-alu-control"><span class="toc-text"> 2. ALU control</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-main-control"><span class="toc-text"> 3. Main control</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-jumps-control"><span class="toc-text"> 4. Jumps control</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98"><span class="toc-text"> 5. 性能问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E6%B0%B4%E7%BA%BF%E6%8A%80%E6%9C%AF"><span class="toc-text"> 流水线技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%83%8C%E6%99%AF"><span class="toc-text"> 1. 背景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%B9%B6%E8%A1%8C%E6%8A%80%E6%9C%AF%E7%9A%84%E4%B8%89%E7%A7%8D%E5%BD%A2%E5%BC%8F"><span class="toc-text"> 2. 并行技术的三种形式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#25-%E6%B5%81%E6%B0%B4%E7%BA%BF%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-text"> 2.5 流水线的分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%B5%81%E6%B0%B4%E7%BA%BF%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9A%84%E7%B3%BB%E7%BB%9F%E7%BB%84%E6%88%90"><span class="toc-text"> 3. 流水线计算机的系统组成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%B5%81%E6%B0%B4%E7%BA%BF%E6%8C%87%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-text"> 4. 流水线指令执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%B5%81%E6%B0%B4%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86"><span class="toc-text"> 5. 流水技术原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%B5%81%E6%B0%B4%E7%BA%BF%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87"><span class="toc-text"> 6. 流水线性能指标</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#61-%E6%B5%81%E6%B0%B4%E6%97%B6%E7%A9%BA%E5%9B%BE"><span class="toc-text"> 6.1 流水时空图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#62-%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%8A%A0%E9%80%9F%E6%AF%94"><span class="toc-text"> 6.2 流水线加速比</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#63-%E5%90%9E%E5%90%90%E7%8E%87-tp"><span class="toc-text"> 6.3 吞吐率 TPTPTP</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E6%B5%81%E6%B0%B4%E7%BA%BF%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-text"> 7. 流水线的特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%86%92%E9%99%A9"><span class="toc-text"> 8. 流水线冒险</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#81-%E7%BB%93%E6%9E%84%E5%86%92%E9%99%A9"><span class="toc-text"> 8.1 结构冒险</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#82-%E6%95%B0%E6%8D%AE%E5%86%92%E9%99%A9"><span class="toc-text"> 8.2 数据冒险</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#83-%E6%8E%A7%E5%88%B6%E5%86%92%E9%99%A9"><span class="toc-text"> 8.3 控制冒险</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8Bmips-%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="toc-text"> 举例：MIPS 流水线</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#risc-%E5%A4%84%E7%90%86%E5%99%A8%E7%89%B9%E7%82%B9"><span class="toc-text"> RISC 处理器特点</span></a></li></ol>
</div></main>
            <aside class="left-column">
              
              <div class="card card-author">
                
  <img 
    src="https://i.loli.net/2021/07/16/yKghkEQWcY34rOU.jpg" 
    class="author-img" 
    alt="author avatar">

<p class="author-name">天泽龟</p>
<p class="author-description">天泽龟的龟是龟裂的龟哦。</p>
<div class="author-message">
  <a 
    class="author-posts-count" 
    href="/archives">
    <span>41</span>
    <span>文章</span>
  </a>
  <a 
    class="author-categories-count" 
    href="/categories">
    <span>5</span>
    <span>分类</span>
  </a>
  <a 
    class="author-tags-count" 
    href="/tags">
    <span>22</span>
    <span>标签</span>
  </a>
</div>

  <div class="author-card-society">
    
      <div class="author-card-society-icon">
        <a target="_blank" rel="noopener" href="https://space.bilibili.com/12645985">
          <i class="iconfont icon-bilibili society-icon"></i>
        </a>
      </div>
    
      <div class="author-card-society-icon">
        <a target="_blank" rel="noopener" href="https://github.com/TURLEing">
          <i class="iconfont icon-github society-icon"></i>
        </a>
      </div>
    
      <div class="author-card-society-icon">
        <a href="https://turleing.github.io/about/">
          <i class="iconfont icon-mail society-icon"></i>
        </a>
      </div>
    
  </div>

              </div>
               <div class="sticky-tablet">
  
  
    <article class="display-when-two-columns spacer">
      <div class="card card-content toc-card">
        <div class="toc-header">
  <i 
    class="iconfont icon-menu" 
    style="padding-right: 2px;">
  </i>目录
</div>
<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E5%9B%9E%E9%A1%BE%E7%9C%8B%E4%B9%8B%E5%89%8D%E7%AC%94%E8%AE%B0"><span class="toc-text"> 知识回顾（看之前笔记）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AC%E5%B8%83%E7%BA%BF%E6%8E%A7%E5%88%B6%E5%99%A8%E6%8A%BD%E8%B1%A1"><span class="toc-text"> 硬布线控制器（抽象）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AC%E5%B8%83%E7%BA%BF%E6%8E%A7%E5%88%B6%E5%99%A8%E4%BB%A5-mips-%E4%B8%BA%E4%BE%8B"><span class="toc-text"> 硬布线控制器（以 MIPS 为例）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-logic-elements"><span class="toc-text"> 1. Logic Elements</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-alu-control"><span class="toc-text"> 2. ALU control</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-main-control"><span class="toc-text"> 3. Main control</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-jumps-control"><span class="toc-text"> 4. Jumps control</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98"><span class="toc-text"> 5. 性能问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E6%B0%B4%E7%BA%BF%E6%8A%80%E6%9C%AF"><span class="toc-text"> 流水线技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%83%8C%E6%99%AF"><span class="toc-text"> 1. 背景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%B9%B6%E8%A1%8C%E6%8A%80%E6%9C%AF%E7%9A%84%E4%B8%89%E7%A7%8D%E5%BD%A2%E5%BC%8F"><span class="toc-text"> 2. 并行技术的三种形式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#25-%E6%B5%81%E6%B0%B4%E7%BA%BF%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-text"> 2.5 流水线的分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%B5%81%E6%B0%B4%E7%BA%BF%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9A%84%E7%B3%BB%E7%BB%9F%E7%BB%84%E6%88%90"><span class="toc-text"> 3. 流水线计算机的系统组成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%B5%81%E6%B0%B4%E7%BA%BF%E6%8C%87%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-text"> 4. 流水线指令执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%B5%81%E6%B0%B4%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86"><span class="toc-text"> 5. 流水技术原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%B5%81%E6%B0%B4%E7%BA%BF%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87"><span class="toc-text"> 6. 流水线性能指标</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#61-%E6%B5%81%E6%B0%B4%E6%97%B6%E7%A9%BA%E5%9B%BE"><span class="toc-text"> 6.1 流水时空图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#62-%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%8A%A0%E9%80%9F%E6%AF%94"><span class="toc-text"> 6.2 流水线加速比</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#63-%E5%90%9E%E5%90%90%E7%8E%87-tp"><span class="toc-text"> 6.3 吞吐率 TPTPTP</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E6%B5%81%E6%B0%B4%E7%BA%BF%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-text"> 7. 流水线的特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%86%92%E9%99%A9"><span class="toc-text"> 8. 流水线冒险</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#81-%E7%BB%93%E6%9E%84%E5%86%92%E9%99%A9"><span class="toc-text"> 8.1 结构冒险</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#82-%E6%95%B0%E6%8D%AE%E5%86%92%E9%99%A9"><span class="toc-text"> 8.2 数据冒险</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#83-%E6%8E%A7%E5%88%B6%E5%86%92%E9%99%A9"><span class="toc-text"> 8.3 控制冒险</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8Bmips-%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="toc-text"> 举例：MIPS 流水线</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#risc-%E5%A4%84%E7%90%86%E5%99%A8%E7%89%B9%E7%82%B9"><span class="toc-text"> RISC 处理器特点</span></a></li></ol>
      </div>
    </article>
  
  
  <article class="card card-content categories-widget">
    <div class="categories-card">
  <div class="categories-header">
    <i 
      class="iconfont icon-fenlei" 
      style="padding-right: 2px;">
    </i>分类
  </div>
  <div class="categories-list">
    
      <a href="/categories/%E7%94%9F%E6%B4%BB%E5%88%86%E4%BA%AB/">
        <div class="categories-list-item">
          生活分享
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/categories/%E7%AE%97%E6%B3%95%E7%AB%9E%E8%B5%9B/">
        <div class="categories-list-item">
          算法竞赛
          <span class="categories-list-item-badge">10</span>
        </div>
      </a>
    
      <a href="/categories/%E4%B8%93%E4%B8%9A%E5%AD%A6%E4%B9%A0/">
        <div class="categories-list-item">
          专业学习
          <span class="categories-list-item-badge">19</span>
        </div>
      </a>
    
      <a href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">
        <div class="categories-list-item">
          机器学习
          <span class="categories-list-item-badge">3</span>
        </div>
      </a>
    
      <a href="/categories/%E7%A4%BE%E5%9B%A2%E6%8E%A8%E9%80%81/">
        <div class="categories-list-item">
          社团推送
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
  </div>
</div>
  </article>
  
  <article class="card card-content tags-widget">
    <div class="tags-card">
  <div class="tags-header">
    <i 
      class="iconfont icon-biaoqian" 
      style="padding-right: 2px;">
    </i>热门标签
  </div>
  <div class="tags-list">
    
      <a 
        href="/tags/%E9%9A%8F%E7%AC%94/" 
        title="随笔">
        <div class="tags-list-item">随笔</div>
      </a>
    
      <a 
        href="/tags/Trie%E6%A0%91/" 
        title="Trie树">
        <div class="tags-list-item">Trie树</div>
      </a>
    
      <a 
        href="/tags/%E6%95%B0%E8%AE%BA/" 
        title="数论">
        <div class="tags-list-item">数论</div>
      </a>
    
      <a 
        href="/tags/%E4%B8%BB%E5%B8%AD%E6%A0%91/" 
        title="主席树">
        <div class="tags-list-item">主席树</div>
      </a>
    
      <a 
        href="/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" 
        title="动态规划">
        <div class="tags-list-item">动态规划</div>
      </a>
    
      <a 
        href="/tags/%E6%80%9D%E7%BB%B4/" 
        title="思维">
        <div class="tags-list-item">思维</div>
      </a>
    
      <a 
        href="/tags/%E6%A0%91%E4%B8%8A%E5%90%AF%E5%8F%91%E5%BC%8F%E5%90%88%E5%B9%B6/" 
        title="树上启发式合并">
        <div class="tags-list-item">树上启发式合并</div>
      </a>
    
      <a 
        href="/tags/%E7%BC%A9%E7%82%B9/" 
        title="缩点">
        <div class="tags-list-item">缩点</div>
      </a>
    
      <a 
        href="/tags/%E7%94%9F%E6%88%90%E5%87%BD%E6%95%B0%E5%85%A5%E9%97%A8/" 
        title="生成函数入门">
        <div class="tags-list-item">生成函数入门</div>
      </a>
    
      <a 
        href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" 
        title="数据结构">
        <div class="tags-list-item">数据结构</div>
      </a>
    
      <a 
        href="/tags/%E7%BD%91%E7%BB%9C%E6%B5%81/" 
        title="网络流">
        <div class="tags-list-item">网络流</div>
      </a>
    
      <a 
        href="/tags/%E6%A0%91%E5%BD%A2DP/" 
        title="树形DP">
        <div class="tags-list-item">树形DP</div>
      </a>
    
      <a 
        href="/tags/%E7%BA%BF%E6%80%A7DP/" 
        title="线性DP">
        <div class="tags-list-item">线性DP</div>
      </a>
    
      <a 
        href="/tags/%E6%9E%84%E9%80%A0/" 
        title="构造">
        <div class="tags-list-item">构造</div>
      </a>
    
      <a 
        href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" 
        title="计算机组成原理">
        <div class="tags-list-item">计算机组成原理</div>
      </a>
    
      <a 
        href="/tags/%E5%8D%9A%E5%BC%88%E8%AE%BA/" 
        title="博弈论">
        <div class="tags-list-item">博弈论</div>
      </a>
    
  </div>
</div>
  </article>
  
  
</div>
            </aside>
            <aside class="right-column">
              <div class="sticky-widescreen">
  
  
    <article class="card card-content toc-card">
      <div class="toc-header">
  <i 
    class="iconfont icon-menu" 
    style="padding-right: 2px;">
  </i>目录
</div>
<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E5%9B%9E%E9%A1%BE%E7%9C%8B%E4%B9%8B%E5%89%8D%E7%AC%94%E8%AE%B0"><span class="toc-text"> 知识回顾（看之前笔记）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AC%E5%B8%83%E7%BA%BF%E6%8E%A7%E5%88%B6%E5%99%A8%E6%8A%BD%E8%B1%A1"><span class="toc-text"> 硬布线控制器（抽象）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AC%E5%B8%83%E7%BA%BF%E6%8E%A7%E5%88%B6%E5%99%A8%E4%BB%A5-mips-%E4%B8%BA%E4%BE%8B"><span class="toc-text"> 硬布线控制器（以 MIPS 为例）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-logic-elements"><span class="toc-text"> 1. Logic Elements</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-alu-control"><span class="toc-text"> 2. ALU control</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-main-control"><span class="toc-text"> 3. Main control</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-jumps-control"><span class="toc-text"> 4. Jumps control</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98"><span class="toc-text"> 5. 性能问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E6%B0%B4%E7%BA%BF%E6%8A%80%E6%9C%AF"><span class="toc-text"> 流水线技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%83%8C%E6%99%AF"><span class="toc-text"> 1. 背景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%B9%B6%E8%A1%8C%E6%8A%80%E6%9C%AF%E7%9A%84%E4%B8%89%E7%A7%8D%E5%BD%A2%E5%BC%8F"><span class="toc-text"> 2. 并行技术的三种形式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#25-%E6%B5%81%E6%B0%B4%E7%BA%BF%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-text"> 2.5 流水线的分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%B5%81%E6%B0%B4%E7%BA%BF%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9A%84%E7%B3%BB%E7%BB%9F%E7%BB%84%E6%88%90"><span class="toc-text"> 3. 流水线计算机的系统组成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%B5%81%E6%B0%B4%E7%BA%BF%E6%8C%87%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-text"> 4. 流水线指令执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%B5%81%E6%B0%B4%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86"><span class="toc-text"> 5. 流水技术原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%B5%81%E6%B0%B4%E7%BA%BF%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87"><span class="toc-text"> 6. 流水线性能指标</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#61-%E6%B5%81%E6%B0%B4%E6%97%B6%E7%A9%BA%E5%9B%BE"><span class="toc-text"> 6.1 流水时空图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#62-%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%8A%A0%E9%80%9F%E6%AF%94"><span class="toc-text"> 6.2 流水线加速比</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#63-%E5%90%9E%E5%90%90%E7%8E%87-tp"><span class="toc-text"> 6.3 吞吐率 TPTPTP</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E6%B5%81%E6%B0%B4%E7%BA%BF%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-text"> 7. 流水线的特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%86%92%E9%99%A9"><span class="toc-text"> 8. 流水线冒险</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#81-%E7%BB%93%E6%9E%84%E5%86%92%E9%99%A9"><span class="toc-text"> 8.1 结构冒险</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#82-%E6%95%B0%E6%8D%AE%E5%86%92%E9%99%A9"><span class="toc-text"> 8.2 数据冒险</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#83-%E6%8E%A7%E5%88%B6%E5%86%92%E9%99%A9"><span class="toc-text"> 8.3 控制冒险</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8Bmips-%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="toc-text"> 举例：MIPS 流水线</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#risc-%E5%A4%84%E7%90%86%E5%99%A8%E7%89%B9%E7%82%B9"><span class="toc-text"> RISC 处理器特点</span></a></li></ol>
    </article>
  
  
  <article class="card card-content">
    <div class="recent-posts-card">
  <div class="recent-posts-header">
    <i 
      class="iconfont icon-wenzhang_huaban" 
      style="padding-right: 2px;">
    </i>最近文章
  </div>
  <div class="recent-posts-list">
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2024-10-01</div>
        <a href="/2024/10/01/baoyan-experience-1/"><div class="recent-posts-item-content">《我的青春保研物语一定有问题》</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2024-07-21</div>
        <a href="/2024/07/21/how_to_research/"><div class="recent-posts-item-content">如何科研入门？</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2024-03-20</div>
        <a href="/2024/03/20/baoyan-fuxi/"><div class="recent-posts-item-content">2024 保研机试复习</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2023-11-15</div>
        <a href="/2023/11/15/os-3/"><div class="recent-posts-item-content">OS Week? - 同步视角的操作系统</div></a>
      </div>
    
  </div>
</div>
  </article>
  
  
</div>
            </aside>
          </div>
        </div>
      </div>
    </div>
     
    <footer class="footer">
  <div class="footer-container">
    <div>
      <div class="footer-dsc">
        <span>
          Copyright ©
          
            2020 -
          
          2024
        </span>
        &nbsp;
        <a 
          href="/" 
          class="footer-link">
          天泽龟的龟壳屋
        </a>
      </div>
    </div>

    
      <div class="footer-dsc">
        
          Powered by
          <a 
            href="https://hexo.io/" 
            class="footer-link" 
            target="_blank" 
            rel="nofollow noopener noreferrer">
            &nbsp;Hexo
          </a>
        
        
          <span>&nbsp;|&nbsp;</span>
        
        
          Theme -
          <a 
            href="https://github.com/theme-kaze" 
            class="footer-link" 
            target="_blank"
            rel="nofollow noopener noreferrer">
            &nbsp;Kaze
          </a>
        
      </div>
    
    
    
    
      <div class="footer-dsc">
        
          本站总访问量<span id="busuanzi_value_site_pv"></span>次
        
        
          <span>&nbsp;|&nbsp;</span>
        
        
          本站总访客数<span id="busuanzi_value_site_uv"></span>次
        
      </div>
      
    
</footer> 
    
  <a 
    role="button" 
    id="scrollbutton" 
    class="basebutton" 
    aria-label="回到顶部">
    <i class="iconfont icon-arrowleft button-icon"></i>
  </a>

<a 
  role="button" 
  id="menubutton" 
  class="basebutton">
  <i class="iconfont icon-menu button-icon"></i>
</a>
<a 
  role="button" 
  id="popbutton" 
  class="basebutton" 
  aria-label="控制中心">
  <i class="iconfont icon-expand button-icon"></i>
</a>
<a 
  role="button" 
  id="darkbutton" 
  class="basebutton darkwidget" 
  aria-label="夜色模式">
  <i class="iconfont icon-weather button-icon"></i>
</a>
<a 
  role="button" 
  id="searchbutton" 
  class="basebutton searchwidget" 
  aria-label="搜索">
  <i class="iconfont icon-search button-icon"></i>
</a> 
     
     
      

  
  
    
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">

  
 
     
     
      <script>
  var addImgLayout = function () {
    var img = document.querySelectorAll('.post-content img')
    var i
    for (i = 0; i < img.length; i++) {
      var wrapper = document.createElement('a')
      wrapper.setAttribute('href', img[i].getAttribute('data-src'))
      wrapper.setAttribute('aria-label', 'illustration')
      wrapper.style.cssText =
        'width: 100%; display: flex; justify-content: center;'
      if (img[i].alt) wrapper.dataset.caption = img[i].alt
      wrapper.dataset.nolink = true
      img[i].before(wrapper)
      wrapper.append(img[i])
      var divWrap = document.createElement('div')
      divWrap.classList.add('gallery')
      wrapper.before(divWrap)
      divWrap.append(wrapper)
    }
    baguetteBox.run('.gallery')
  }
</script>
<script>
  loadScript(
    "/js/lib/lightbox/baguetteBox.min.js",
    addImgLayout
  )
</script>
 
     
     
    <script src="/js/main.js"></script> 
    
      <script> 
        loadScript('/js/lib/busuanzi.min.js') 
      </script>
     
    
      <script>
        var addLazyload = function () {
          var observer = lozad('.lozad', {
            load: function (el) {
              el.srcset = el.getAttribute('data-src')
            },
            loaded: function (el) {
              el.classList.add('loaded')
            },
          })
          observer.observe()
        }
      </script>
      <script>
        loadScript('/js/lib/lozad.min.js', addLazyload)
      </script>
     
    
    
  </body>
</html>
